//*
 * Keymap cho b√†n ph√≠m 9 n√∫t + encoder
 * Layout 3x3 + 1 n√∫m xoay ·ªü v·ªã tr√≠ ph√≠m [3,3]
 */

#include <behaviors.dtsi>
#include <dt-bindings/zmk/keys.h>
#include <dt-bindings/zmk/bt.h>

#define BASE 0
#define FN 1

/ {
    // 1Ô∏è‚É£ C·∫•u h√¨nh encoder
    sensors {
        compatible = "zmk,keymap-sensors";
        sensors = <&encoder_1>;
        triggers-per-rotation = <24>;
    };

    keymap {
        compatible = "zmk,keymap";

        // 2Ô∏è‚É£ Layer ch√≠nh (3x3 keys)
        default_layer {
            bindings = <
                &kp Q     &kp W     &kp E      // H√†ng 1
                &kp A     &kp S     &kp D      // H√†ng 2
                &kp Z     &kp X     &mo FN     // H√†ng 3 - Ph√≠m [3,3] l√† encoder
            >;
            
            // üîÑ Encoder: Volume (xoay) + Nh·∫•n: Mute
            sensor-bindings = <&inc_dec_kp C_VOL_DN C_VOL_UP>;
        };

        // 3Ô∏è‚É£ Layer ch·ª©c nƒÉng
        fn_layer {
            bindings = <
                &kp F1    &kp F2    &kp F3     // H√†ng 1
                &none     &kp C_MUTE &bt BT_NXT // H√†ng 2
                &sys_reset &none    &trans      // H√†ng 3 - Gi·ªØ nguy√™n v·ªã tr√≠ encoder
            >;
            
            // üîÑ Encoder: Cu·ªôn trang (xoay) + Nh·∫•n: Play/Pause
            sensor-bindings = <&inc_dec_kp PG_DN PG_UP>;
        };
    };
};

// 4Ô∏è‚É£ C·∫•u h√¨nh ph·∫ßn c·ª©ng encoder
/ {
    encoders {
        compatible = "zmk,encoders";
        encoder_1: encoder_1 {
            status = "okay";
            a-gpios = <&gpio0 5 (GPIO_ACTIVE_HIGH | GPIO_PULL_UP)>; // Ch√¢n A
            b-gpios = <&gpio0 6 (GPIO_ACTIVE_HIGH | GPIO_PULL_UP)>; // Ch√¢n B
        };
    };
};
